(()=>{"use strict";function e(e,t,n,o,r,c,a,i){var u=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),d=u.querySelector(".card__image"),s=u.querySelector(".card__like-button");s.id=t;var l=u.querySelector(".like"),f=u.querySelector(".card__delete-button"),p=u.querySelector("button");return d.src=r,u.querySelector(".card__title").textContent=c,d.alt=c,u.id=t,"1fff6a9b44b2ebd8e3ab0f01"!==n?p.remove():f.addEventListener("click",(function(){return e(u.id)})),s.addEventListener("click",(function(){return a(s,l)})),l.textContent=o,d.addEventListener("click",(function(){return i(r,c)})),u}function t(e,t){"card__like-button"===e.classList.value?(e.classList.toggle("card__like-button_is-active"),fetch("https://nomoreparties.co/v1/wff-cohort-10/cards/likes/".concat(e.id),{method:"PUT",headers:{authorization:"57dd4f5d-dace-4e52-a052-4e42c99f4a48"}}).then((function(e){return e.json()})).then((function(e){t.textContent=e.likes.length}))):(e.classList.toggle("card__like-button_is-active"),fetch("https://nomoreparties.co/v1/wff-cohort-10/cards/likes/".concat(e.id),{method:"DELETE",headers:{authorization:"57dd4f5d-dace-4e52-a052-4e42c99f4a48"}}).then((function(e){return e.json()})).then((function(e){t.textContent=e.likes.length})))}function n(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function o(e){"Escape"===e.key&&r(document.querySelector(".popup_is-opened"))}function r(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function c(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove("form__submit_inactive"),t.classList.add("form__submit_active")):(t.disabled=!0,t.classList.add("form__submit_inactive"),t.classList.remove("form__submit_active"))}var a=document.querySelector(".profile__title"),i=document.querySelector(".profile__description"),u=document.querySelector(".places__list"),d=document.querySelector(".profile__image");document.querySelectorAll(".popup").forEach((function(e){e.classList.add("popup_is-animated"),e.addEventListener("click",(function(e){e.currentTarget===e.target&&r(e.target)})),e.querySelector(".popup__close").addEventListener("click",(function(){return r(e)}))}));var s=document.forms["edit-profile"],l=document.querySelector(".popup_type_edit");document.querySelector(".profile__edit-button").addEventListener("click",(function(){s.name.value=a.textContent,s.description.value=i.textContent,m(l),n(l)})),s.addEventListener("submit",(function(e){var t,n;e.preventDefault(),a.textContent=s.name.value,i.textContent=s.description.value,b(!0),t=a.textContent,n=i.textContent,b(!1),fetch("https://nomoreparties.co/v1/wff-cohort-10/users/me",{method:"PATCH",headers:{authorization:"57dd4f5d-dace-4e52-a052-4e42c99f4a48","Content-Type":"application/json"},body:JSON.stringify({name:"".concat(t),about:"".concat(n)})}).finally((function(){})),r(l)}));var f=document.forms["new-place"],p=document.querySelector(".popup_type_new-card");function m(e){e.querySelectorAll(".popup__input-error").forEach((function(e){e.textContent=""})),e.querySelectorAll(".popup__input ").forEach((function(e){e.style="border-bottom: 1px solid rgba(0,0,0,.2)"})),e.querySelector(".popup__button").classList.add("form__submit_inactive")}function _(e,t){var o=document.querySelector(".popup_type_image "),r=o.querySelector(".popup__image"),c=o.querySelector(".popup__caption");r.src=e,c.textContent=t,n(o)}function v(e){var t=document.querySelector(".popup_delete_card");n(t),function(e,t){document.forms.form_delete_card.addEventListener("submit",(function(n){n.preventDefault(),function(e){fetch("https://nomoreparties.co/v1/wff-cohort-10/cards/".concat(e),{method:"DELETE",headers:{authorization:"57dd4f5d-dace-4e52-a052-4e42c99f4a48"}})}(e),r(t),document.getElementById("".concat(e)).remove()}))}(e,t)}document.querySelector(".profile__add-button").addEventListener("click",(function(){n(p)})),f.addEventListener("submit",(function(n){n.preventDefault();var o=f["place-name"].value,c=f.link.value;b(!0),function(e,t,n,o,r,c,a,i){fetch("https://nomoreparties.co/v1/wff-cohort-10/cards",{method:"POST",headers:{authorization:"57dd4f5d-dace-4e52-a052-4e42c99f4a48","Content-Type":"application/json"},body:JSON.stringify({name:"".concat(t),link:"".concat(e)})}).then((function(e){return e.json()})).then((function(e){var t=a(o,e._id,e.owner._id,e.likes.length,e.link,e.name,r,c);i.prepend(t)})).finally((function(){}))}(c,o,b(!1),v,t,_,e,u),f.reset(),m(p),r(p)})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");c(t,n),t.forEach((function(o){o.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t){t.style="border-bottom: 1px solid rgba(0,0,0,.2);",e.querySelector(".".concat(t.id,"-error")).textContent=""}(e,t):function(e,t,n){t.style="border-bottom: 1px solid red;",e.querySelector(".".concat(t.id,"-error")).textContent=n}(e,t,t.validationMessage)}(e,o),c(t,n)}))}))}(e)})),function(e,t,n){fetch("https://nomoreparties.co/v1/wff-cohort-10/users/me",{headers:{authorization:"57dd4f5d-dace-4e52-a052-4e42c99f4a48"}}).then((function(e){return e.json()})).then((function(o){e.textContent=o.name,t.textContent=o.about,n.style='background-image: url("'.concat(o.avatar,'")')}))}(a,i,d),function(e,t,n,o,r){fetch("https://nomoreparties.co/v1/wff-cohort-10/cards",{headers:{authorization:"57dd4f5d-dace-4e52-a052-4e42c99f4a48"}}).then((function(e){return e.json()})).then((function(c){c.forEach((function(c){var a=o(e,c._id,c.owner._id,c.likes.length,c.link,c.name,t,n);r.append(a)}))}))}(v,t,_,e,u);var h=document.querySelector(".avatar_edit_popup");document.querySelector(".profile__image_button").addEventListener("click",(function(){n(h)}));var y=document.forms.avatar_edit;function b(e){document.querySelector(".popup__button").textContent=e?"Сохранение...":"Сохранить"}y.addEventListener("submit",(function(e){var t;e.preventDefault(),b(!0),t=y.avatar.value,b(!1),fetch("https://nomoreparties.co/v1/wff-cohort-10/users/me/avatar",{method:"PATCH",headers:{authorization:"57dd4f5d-dace-4e52-a052-4e42c99f4a48","Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(t)})}).finally((function(){})),y.reset(),m(h),r(h)}))})();